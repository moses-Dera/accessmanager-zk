<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StarkAccess Protocol â€” ZK Demo</title>
    <meta name="description"
        content="Interactive demo of the StarkAccess ZK Protocol â€” anonymous access control on Starknet using Noir zero-knowledge proofs.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”</text></svg>">
    <style>
        /* â”€â”€ Variables â”€â”€ */
        :root {
            --bg: #030812;
            --surface: rgba(255, 255, 255, 0.04);
            --surface-hover: rgba(255, 255, 255, 0.07);
            --border: rgba(255, 255, 255, 0.08);
            --border-glow: rgba(100, 180, 255, 0.3);
            --text: #e8edf5;
            --muted: rgba(232, 237, 245, 0.45);
            --accent: #4f9eff;
            --accent2: #a78bfa;
            --green: #34d399;
            --red: #f87171;
            --yellow: #fbbf24;
            --glow-blue: rgba(79, 158, 255, 0.15);
            --glow-purple: rgba(167, 139, 250, 0.12);
            --radius: 16px;
            --radius-sm: 10px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* â”€â”€ Background orbs â”€â”€ */
        .bg-orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(120px);
            pointer-events: none;
            z-index: 0;
        }

        .bg-orb-1 {
            width: 600px;
            height: 600px;
            background: rgba(79, 158, 255, 0.08);
            top: -200px;
            left: -100px;
        }

        .bg-orb-2 {
            width: 500px;
            height: 500px;
            background: rgba(167, 139, 250, 0.08);
            top: 30%;
            right: -150px;
        }

        .bg-orb-3 {
            width: 400px;
            height: 400px;
            background: rgba(52, 211, 153, 0.06);
            bottom: -100px;
            left: 30%;
        }

        /* â”€â”€ Layout â”€â”€ */
        .page {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 24px 80px;
        }

        /* â”€â”€ Header â”€â”€ */
        header {
            text-align: center;
            margin-bottom: 60px;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            box-shadow: 0 0 30px rgba(79, 158, 255, 0.4);
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .logo-text span {
            color: var(--accent);
        }

        h1 {
            font-size: clamp(32px, 5vw, 52px);
            font-weight: 700;
            letter-spacing: -1.5px;
            line-height: 1.15;
        }

        h1 em {
            font-style: normal;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            margin-top: 14px;
            color: var(--muted);
            font-size: 16px;
            line-height: 1.6;
            max-width: 560px;
            margin-inline: auto;
        }

        /* â”€â”€ Network badge â”€â”€ */
        .network-badge {
            display: inline-flex;
            align-items: center;
            gap: 7px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 100px;
            padding: 5px 14px 5px 10px;
            font-size: 13px;
            margin-top: 20px;
        }

        .net-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--green);
            box-shadow: 0 0 8px var(--green);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1
            }

            50% {
                opacity: 0.5
            }
        }

        /* â”€â”€ Account bar â”€â”€ */
        #account-bar {
            display: none;
            margin-bottom: 24px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 12px 16px;
            font-size: 13px;
            color: var(--muted);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #account-bar span {
            color: var(--accent);
            font-family: 'JetBrains Mono', monospace;
        }

        /* â”€â”€ Steps timeline â”€â”€ */
        .steps {
            display: grid;
            gap: 16px;
        }

        /* â”€â”€ Card â”€â”€ */
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            transition: border-color .25s, background .25s;
            position: relative;
            overflow: hidden;
        }

        .card.active {
            border-color: var(--border-glow);
            background: rgba(79, 158, 255, 0.05);
        }

        .card.done {
            border-color: rgba(52, 211, 153, 0.25);
            background: rgba(52, 211, 153, 0.03);
        }

        .card.error {
            border-color: rgba(248, 113, 113, 0.3);
            background: rgba(248, 113, 113, 0.04);
        }

        /* card glow line */
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            opacity: 0;
            transition: opacity .3s;
        }

        .card.active::before {
            opacity: 1;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 16px;
        }

        .step-num {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(79, 158, 255, 0.12);
            border: 1px solid rgba(79, 158, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
            color: var(--accent);
            flex-shrink: 0;
            transition: all .3s;
        }

        .card.done .step-num {
            background: rgba(52, 211, 153, 0.15);
            border-color: rgba(52, 211, 153, 0.4);
            color: var(--green);
        }

        .card.error .step-num {
            background: rgba(248, 113, 113, 0.15);
            border-color: rgba(248, 113, 113, 0.4);
            color: var(--red);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            flex: 1;
        }

        .card-status {
            font-size: 12px;
            font-family: 'JetBrains Mono', monospace;
            color: var(--muted);
        }

        .card.done .card-status {
            color: var(--green);
        }

        .card.error .card-status {
            color: var(--red);
        }

        /* â”€â”€ Button â”€â”€ */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 11px 22px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all .2s;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), #2563eb);
            color: #fff;
            box-shadow: 0 4px 20px rgba(79, 158, 255, 0.35);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 28px rgba(79, 158, 255, 0.45);
        }

        .btn-primary:disabled {
            opacity: .45;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            color: #fff;
            box-shadow: 0 4px 16px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        .btn-danger:disabled {
            opacity: .45;
            cursor: not-allowed;
        }

        /* â”€â”€ Output log â”€â”€ */
        .log-box {
            margin-top: 14px;
            background: rgba(0, 0, 0, 0.35);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: var(--radius-sm);
            padding: 14px 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12.5px;
            line-height: 1.7;
            max-height: 220px;
            overflow-y: auto;
            color: var(--muted);
        }

        .log-box:empty {
            display: none;
        }

        .log-line {
            padding: 1px 0;
        }

        .log-line.ok {
            color: var(--green);
        }

        .log-line.err {
            color: var(--red);
        }

        .log-line.info {
            color: var(--accent);
        }

        .log-line.warn {
            color: var(--yellow);
        }

        /* â”€â”€ KV pairs â”€â”€ */
        .kv {
            display: grid;
            gap: 6px;
            margin-top: 10px;
        }

        .kv-row {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 13px;
        }

        .kv-key {
            color: var(--muted);
            min-width: 130px;
            flex-shrink: 0;
        }

        .kv-val {
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent);
            word-break: break-all;
            font-size: 12px;
        }

        /* â”€â”€ Balance display â”€â”€ */
        .balance-display {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 16px 20px;
            margin-top: 12px;
        }

        .balance-label {
            color: var(--muted);
            font-size: 13px;
        }

        .balance-val {
            font-size: 28px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--green);
            transition: all .5s;
        }

        .balance-val.changed {
            animation: flash .5s;
        }

        @keyframes flash {
            0% {
                color: var(--yellow)
            }

            100% {
                color: var(--green)
            }
        }

        /* â”€â”€ Proof viz â”€â”€ */
        .proof-card {
            display: none;
            margin-top: 12px;
            background: rgba(167, 139, 250, 0.06);
            border: 1px solid rgba(167, 139, 250, 0.2);
            border-radius: var(--radius-sm);
            padding: 16px;
        }

        .proof-card.visible {
            display: block;
        }

        .proof-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--accent2);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .proof-bytes {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: rgba(167, 139, 250, 0.8);
            line-height: 1.6;
            word-break: break-all;
        }

        /* â”€â”€ Spinner â”€â”€ */
        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin .7s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }

        /* â”€â”€ Security banner â”€â”€ */
        .security-banner {
            display: none;
            margin-top: 12px;
            padding: 14px 16px;
            background: rgba(52, 211, 153, 0.08);
            border: 1px solid rgba(52, 211, 153, 0.25);
            border-radius: var(--radius-sm);
            font-size: 13.5px;
            color: var(--green);
        }

        .security-banner.fail {
            background: rgba(248, 113, 113, 0.08);
            border-color: rgba(248, 113, 113, 0.25);
            color: var(--red);
        }

        /* â”€â”€ Footer â”€â”€ */
        footer {
            text-align: center;
            margin-top: 60px;
            color: var(--muted);
            font-size: 13px;
        }

        footer a {
            color: var(--accent);
            text-decoration: none;
        }

        /* â”€â”€ Scrollbar â”€â”€ */
        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        /* â”€â”€ Documentation Sections â”€â”€ */
        .docs-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .docs-section h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .docs-section h2 span {
            color: var(--accent);
        }

        .docs-section p {
            color: var(--muted);
            line-height: 1.7;
            margin-bottom: 20px;
            font-size: 15px;
        }

        .docs-section ul {
            color: var(--muted);
            line-height: 1.7;
            margin-bottom: 20px;
            font-size: 15px;
            padding-left: 20px;
        }

        .docs-section li {
            margin-bottom: 8px;
        }

        .docs-section li strong {
            color: #fff;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            padding: 16px 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13.5px;
            line-height: 1.6;
            color: #e8edf5;
            overflow-x: auto;
            margin-bottom: 20px;
        }

        .code-block .keyword {
            color: var(--accent2);
        }

        .code-block .function {
            color: var(--accent);
        }

        .code-block .string {
            color: var(--green);
        }

        .code-block .comment {
            color: rgba(232, 237, 245, 0.4);
        }

        .demo-title {
            text-align: center;
            margin: 60px 0 30px;
            padding-top: 40px;
            border-top: 1px solid var(--border);
            font-size: 28px;
        }
    </style>
</head>

<body>
    <div class="bg-orb bg-orb-1"></div>
    <div class="bg-orb bg-orb-2"></div>
    <div class="bg-orb bg-orb-3"></div>

    <div class="page">
        <!-- Header -->
        <header>
            <div class="logo">
                <!-- <div class="logo-icon">ğŸ”</div> -->
                <div class="logo-text">Stark<span>Access</span></div>
            </div>
            <h1>Anonymous Access Control<br>with <em>Zero-Knowledge Proofs</em></h1>
            <p class="subtitle">
                A live demo of ZK-gated contract interactions on Starknet â€”
                prove you belong to a group without revealing who you are.
            </p>
            <div class="network-badge">
                <div class="net-dot"></div>
                <span id="net-label">Starknet Sepolia</span>
            </div>
            <div style="margin-top:20px;">
                <a href="https://github.com/moses-Dera/accessmanager-zk" target="_blank" class="btn"
                    style="background:var(--surface);border:1px solid var(--border);color:var(--text);font-size:13px;padding:8px 16px;">
                    View on GitHub
                </a>
            </div>
        </header>

        <!-- Account bar -->
        <div id="account-bar">
            ğŸªª Connected: <span id="account-addr">â€”</span>
        </div>

        <!-- Documentation Sections -->

        <!-- Technical Whitepaper -->
        <div class="docs-section" style="border-left: 4px solid var(--accent2);">
            <h2 style="font-size: 28px; margin-bottom: 24px;"><span>00.</span> StarkAccess: Technical Whitepaper</h2>

            <h3 style="color:#fff; font-size:18px; margin-top:24px; margin-bottom:12px;">1. The Web3 Privacy Problem
            </h3>
            <p>In traditional Web2, applications rely on centralized servers (like "Sign-in with Google" or Discord
                roles) to handle identity verification. In Web3, standard access control relies on public token
                balances, NFTs, or hardcoded whitelists. If a DAO wants to allow only NFT holders to vote, the user must
                publicly link their wallet to their vote, completely destroying privacy and exposing their financial
                holdings.</p>
            <p><strong>StarkAccess solves this by separating <em>identity</em> from <em>action</em>.</strong></p>

            <h3 style="color:#fff; font-size:18px; margin-top:32px; margin-bottom:12px;">2. Core Cryptography</h3>
            <p>StarkAccess is built entirely on Zero-Knowledge cryptography to achieve anonymous verification. We
                utilize <strong>Noir</strong>, the universal language for zero-knowledge proving, which compiles down to
                efficient ACIR (Abstract Circuit Intermediate Representation) and eventually down to Groth16 or
                UltraHonk proof backend formats.</p>
            <p>For hashing, the protocol strictly uses the <strong>Poseidon</strong> hash function, which is natively
                ZK-friendly and mathematically optimized for efficient circuit execution.</p>

            <h3 style="color:#fff; font-size:18px; margin-top:32px; margin-bottom:12px;">3. The Protocol Flow (Identity
                & Action)</h3>
            <p>The system works through three distinct cryptographic phases:</p>
            <ul>
                <li><strong>The Commitment Phase:</strong> A governing body (like a DAO) defines a list of authorized
                    users. Instead of publishing their addresses, they publish a single <strong>Merkle Root</strong>
                    derived from a Merkle Tree of Poseidon hashes of the users' hidden secrets (commitments). This Root
                    is registered on the <code>AccessManagerZK</code> Starknet contract as the "Role ID".</li>
                <li><strong>The Proof Phase:</strong> To take an action (e.g., voting), a user generates a
                    Zero-Knowledge Proof entirely locally inside their browser. The circuit proves: <em>"I possess a
                        secret `s` such that `Poseidon(s)` is a valid leaf in the Merkle Tree with the public Root
                        `R`."</em> <strong>The secret `s` is never revealed or submitted on-chain.</strong></li>
                <li><strong>The Sybil Resistance Phase (Nullifiers):</strong> To prevent a user from voting twice with
                    the same secret, the circuit simultaneously computes a <strong>Nullifier</strong>. The Nullifier is
                    calculated as <code>Poseidon(secret, action_hash)</code>. Because it includes the
                    <code>action_hash</code> (a specific context, like "Vote_Proposal_12"), the user gets exactly one
                    unique nullifier per action. If they submit the proof again, the Starknet contract rejects the
                    transaction because the nullifier has already been recorded ("spent").
                </li>
            </ul>

            <h3 style="color:#fff; font-size:18px; margin-top:32px; margin-bottom:12px;">4. Starknet Smart Contract
                Architecture</h3>
            <p>The on-chain component is defined by the <code>AccessManagerZK</code> Cairo contract. It acts as the
                "Decentralized OAuth Server." Third-party protocols (like <code>ProtectedTreasury</code> or
                <code>DAO_Voting</code>) do not need to parse raw ZK bytes; they simply call `AccessManagerZK`'s
                `verify_proof_and_consume()` function, passing in the action and the proof payload payload. The
                AccessManager checks the SNARK verification and securely records the nullifier, returning a simple
                <code>true</code> or <code>false</code> to the calling contract.
            </p>
        </div>

        <!-- Architecture -->
        <div class="docs-section">
            <h2><span>01.</span> The Architecture</h2>
            <p>StarkAccess acts as the central identity verifier. Instead of a dApp keeping an internal whitelist of
                authorized addresses (which sacrifices privacy), the dApp relies on StarkAccess.</p>
            <ul>
                <li><strong>The Group:</strong> The DAO defines authorized members off-chain and generates a Merkle Tree
                    from their hidden secrets.</li>
                <li><strong>The Registry:</strong> This Merkle Root is registered on the central
                    <code>AccessManagerZK</code> contract, creating a unique Role ID.
                </li>
                <li><strong>The Proof:</strong> Users generate a Zero-Knowledge Proof locally stating <em>"I possess a
                        secret in this tree"</em> without revealing which one.</li>
                <li><strong>The Nullifier:</strong> Along with the proof, a unique mathematical "nullifier" is generated
                    to prevent users from taking an action (like voting) twice.</li>
            </ul>
        </div>

        <!-- Smart Contract Integration -->
        <div class="docs-section">
            <h2><span>02.</span> Smart Contract Integration</h2>
            <p>Integrating StarkAccess into your Cairo smart contract takes just one line of code. You simply call the
                <code>verify_proof_and_consume</code> function on the Access Manager.
            </p>
            <div class="code-block">
                <pre><span class="comment">// 1. Initialize the Access Manager Dispatcher</span>
<span class="keyword">let</span> access_manager = IAccessManagerDispatcher {
    contract_address: self.starkaccess_address.read()
};

<span class="comment">// 2. Ask StarkAccess to verify the proof!</span>
<span class="comment">// This checks the ZK proof AND prevents double-actions via the nullifier</span>
<span class="keyword">let</span> is_valid = access_manager.<span class="function">verify_proof_and_consume</span>(
    root, 
    action_hash, 
    nullifier, 
    proof
);

<span class="function">assert</span>(is_valid, <span class="string">'UNAUTHORIZED_OR_ALREADY_USED'</span>);</pre>
            </div>
            <p>There is no complex ZK math in your codebase. You treat exactly like verifying a traditional Web2 API JWT
                token.</p>
            <div
                style="margin-top:20px; padding:12px 16px; background:rgba(255,255,255,0.05); border-left:3px solid var(--accent); border-radius:6px; font-size:13px; color:var(--muted)">
                <strong>Note on Smart Contract Standards:</strong> The demo contracts currently deployed use custom,
                simplified state variables for access control and balances. For mainnet production, these contracts are
                being refactored to seamlessly inherit from <strong>OpenZeppelin's Ownable and ERC20</strong> components
                for battle-tested, standardized security.
            </div>
        </div>

        <!-- Frontend Integration -->
        <div class="docs-section">
            <h2><span>03.</span> The "Sign-in with Google" Frontend Flow</h2>
            <p>For the end-user, the experience is exactly like a seamless OAuth login. The entire proof generation
                happens locally in their browser so their secret remains safe.</p>
            <div class="code-block">
                <pre><span class="comment">// 1. You add a simple button to your frontend</span>
&lt;button onClick={<span class="function">handleStarkAccessVerify</span>}&gt;
  Sign in with StarkAccess
&lt;/button&gt;

<span class="comment">// 2. When clicked, use the StarkAccess SDK to generate the proof</span>
<span class="keyword">const</span> { root, nullifier, proof } = <span class="keyword">await</span> starkAccess.<span class="function">generateProof</span>(secret);

<span class="comment">// 3. Submit the result directly to your DAO Smart Contract</span>
<span class="keyword">await</span> myDaoContract.<span class="function">cast_vote</span>(root, action_hash, nullifier, proof);</pre>
            </div>
            <p>No backend server is needed, no private data ever leaves the user's laptop.</p>
        </div>

        <!-- Contract Details -->
        <div class="docs-section">
            <h2><span>04.</span> Deployed Sepolia Contracts</h2>
            <p>You can interact with the live StarkAccess protocol on the Starknet Sepolia testnet right now. Here are
                the core contract addresses used in the demo below:</p>
            <div class="kv">
                <div class="kv-row" style="margin-bottom:8px;">
                    <span class="kv-key">AccessManagerZK</span>
                    <span class="kv-val">0x32869a7ba6ae5b9f8f6f6414ce0d64a01e4b50db6bed08401e8239ff5595596</span>
                </div>
                <div class="kv-row" style="margin-bottom:8px;">
                    <span class="kv-key">MockVerifier</span>
                    <span class="kv-val">0x39b6a91006b1ef32eec501ba68a1fc378232a80759f0f62ae601b9e039956b9</span>
                </div>
                <div class="kv-row" style="margin-bottom:8px;">
                    <span class="kv-key">ProtectedTreasury</span>
                    <span class="kv-val">0x60a26b252ae4c88809f2b90ddf48bd4b638cb1ea463e32327dff064127e4767</span>
                </div>
            </div>
        </div>

        <h2 class="demo-title">Live Interactive Demo</h2>

        <div class="steps">

            <!-- STEP 1: Connect -->
            <div class="card active" id="card-1">
                <div class="card-header">
                    <div class="step-num">1</div>
                    <div class="card-title">Connect Account</div>
                    <div class="card-status" id="status-1">pending</div>
                </div>
                <p style="font-size:14px;color:var(--muted);margin-bottom:14px;">
                    Enter your Sepolia account credentials to connect to the node.
                </p>
                <div style="display:grid;gap:10px;margin-bottom:14px;">
                    <div>
                        <label style="font-size:12px;color:var(--muted);display:block;margin-bottom:5px;">RPC
                            URL</label>
                        <input id="rpc-url" type="text"
                            placeholder="https://starknet-sepolia.public... / http://127.0.0.1:5050"
                            style="width:100%;background:rgba(0,0,0,0.3);border:1px solid var(--border);border-radius:8px;padding:9px 12px;color:var(--text);font-size:13px;font-family:inherit;outline:none;">
                    </div>
                    <div>
                        <label style="font-size:12px;color:var(--muted);display:block;margin-bottom:5px;">Account
                            Address</label>
                        <input id="acct-addr" type="text" placeholder="0x..."
                            style="width:100%;background:rgba(0,0,0,0.3);border:1px solid var(--border);border-radius:8px;padding:9px 12px;color:var(--text);font-size:13px;font-family:'JetBrains Mono',monospace;outline:none;">
                    </div>
                    <div>
                        <label style="font-size:12px;color:var(--muted);display:block;margin-bottom:5px;">Private
                            Key</label>
                        <input id="priv-key" type="password" placeholder="0x..."
                            style="width:100%;background:rgba(0,0,0,0.3);border:1px solid var(--border);border-radius:8px;padding:9px 12px;color:var(--text);font-size:13px;font-family:'JetBrains Mono',monospace;outline:none;">
                    </div>
                </div>
                <button class="btn btn-primary" id="btn-connect" onclick="doConnect()">
                    Connect â†’
                </button>
                <div class="log-box" id="log-1"></div>
            </div>

            <!-- STEP 2: Deploy Contracts -->
            <div class="card" id="card-2">
                <div class="card-header">
                    <div class="step-num">2</div>
                    <div class="card-title">Load Contracts (Sepolia)</div>
                    <div class="card-status" id="status-2">waiting</div>
                </div>
                <p style="font-size:14px;color:var(--muted);margin-bottom:14px;">
                    Load the pre-deployed <strong style="color:var(--text)">MockVerifier</strong>,
                    <strong style="color:var(--text)">AccessManagerZK</strong>, and
                    <strong style="color:var(--text)">ProtectedTreasury</strong> on Sepolia.
                </p>
                <button class="btn btn-primary" id="btn-deploy" onclick="doLoadContracts()" disabled>
                    Connect to Contracts â†’
                </button>
                <div class="log-box" id="log-2"></div>
                <div class="kv" id="deploy-kv"></div>
            </div>

            <!-- STEP 3: Setup Role -->
            <div class="card" id="card-3">
                <div class="card-header">
                    <div class="step-num">3</div>
                    <div class="card-title">Setup Merkle Root</div>
                    <div class="card-status" id="status-3">waiting</div>
                </div>
                <p style="font-size:14px;color:var(--muted);margin-bottom:14px;">
                    The treasury owner registers the Merkle root of authorised users with the AccessManager.
                    This root is derived from Poseidon hashes of user secrets.
                </p>
                <button class="btn btn-primary" id="btn-setup" onclick="doSetup()" disabled>
                    Register Merkle Root â†’
                </button>
                <div class="log-box" id="log-3"></div>
                <div class="kv" id="setup-kv"></div>
            </div>

            <!-- STEP 4: Generate ZK Proof -->
            <div class="card" id="card-4">
                <div class="card-header">
                    <div class="step-num">4</div>
                    <div class="card-title">Generate ZK Proof</div>
                    <div class="card-status" id="status-4">waiting</div>
                </div>
                <p style="font-size:14px;color:var(--muted);margin-bottom:14px;">
                    The user proves they know a <em>secret</em> whose Poseidon commitment is in the Merkle tree,
                    and binds the proof to a unique <em>nullifier</em> â€” without revealing their identity.
                </p>
                <button class="btn btn-primary" id="btn-proof" onclick="doProof()" disabled>
                    Generate ZK Proof â†’
                </button>
                <div class="log-box" id="log-4"></div>
                <div class="proof-card" id="proof-viz">
                    <div class="proof-title">âš¡ Proof Public Inputs</div>
                    <div class="kv" id="proof-kv"></div>
                </div>
            </div>

            <!-- STEP 5: Withdraw -->
            <div class="card" id="card-5">
                <div class="card-header">
                    <div class="step-num">5</div>
                    <div class="card-title">ZK-Gated Withdrawal</div>
                    <div class="card-status" id="status-5">waiting</div>
                </div>
                <p style="font-size:14px;color:var(--muted);margin-bottom:14px;">
                    Submit the ZK proof to the treasury. The contract verifies it through the AccessManager
                    and releases funds anonymously.
                </p>
                <button class="btn btn-primary" id="btn-withdraw" onclick="doWithdraw()" disabled>
                    Withdraw 500 Tokens â†’
                </button>
                <div class="log-box" id="log-5"></div>
                <div class="balance-display" id="balance-display" style="display:none">
                    <div>
                        <div class="balance-label">Treasury Balance</div>
                    </div>
                    <div class="balance-val" id="balance-val">â€”</div>
                </div>
            </div>

            <!-- STEP 6: Replay Attack -->
            <div class="card" id="card-6">
                <div class="card-header">
                    <div class="step-num">6</div>
                    <div class="card-title">Replay Attack Test</div>
                    <div class="card-status" id="status-6">waiting</div>
                </div>
                <p style="font-size:14px;color:var(--muted);margin-bottom:14px;">
                    Attempt to re-submit the same proof and nullifier. The contract should reject it â€”
                    the nullifier is permanently recorded on-chain after first use.
                </p>
                <button class="btn btn-danger" id="btn-replay" onclick="doReplay()" disabled>
                    âš  Attempt Replay Attack
                </button>
                <div class="log-box" id="log-6"></div>
                <div class="security-banner" id="sec-banner"></div>
            </div>

        </div>
        <!-- /steps -->

        <footer>
            Built with <a href="https://noir-lang.org" target="_blank">Noir</a>,
            <a href="https://starknet.io" target="_blank">Starknet</a>, and
            <a href="https://www.cairo-lang.org" target="_blank">Cairo</a>.
            &nbsp;|&nbsp;
            <a href="https://github.com/moses-Dera/accessmanager-zk" target="_blank">GitHub</a>
        </footer>
    </div>

    <!-- starknet.js via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/starknet@9.2.1/dist/index.global.js"></script>
    <script>
        // Use global window.starknet object
        const { RpcProvider, Account, Contract, CallData, stark } = window.starknet;

        // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const state = {
            provider: null,
            account: null,
            // Deployed addresses
            verifierAddr: null,
            managerAddr: null,
            treasuryAddr: null,
            // Treasury contract w/ account as signer
            treasury: null,
            treasuryAbi: null,
            // ZK Proof data
            root: null,
            actionHash: null,
            nullifier: null,
            proofFelts: null,
        };

        // Contract ABIs (minimal required for demo to pass Contract constructor)
        let ABIS = {
            treasury: [
                {
                    "type": "function",
                    "name": "setup_role_root",
                    "inputs": [{ "name": "root", "type": "core::felt252" }],
                    "outputs": [],
                    "state_mutability": "external"
                },
                {
                    "type": "function",
                    "name": "withdraw",
                    "inputs": [
                        { "name": "amount", "type": "core::integer::u256" },
                        { "name": "proof", "type": "core::array::Span::<core::felt252>" },
                        { "name": "public_inputs", "type": "core::array::Span::<core::felt252>" }
                    ],
                    "outputs": [{ "type": "()" }],
                    "state_mutability": "external"
                },
                {
                    "type": "function",
                    "name": "get_balance",
                    "inputs": [],
                    "outputs": [{ "type": "core::integer::u256" }],
                    "state_mutability": "view"
                }
            ]
        };

        // â”€â”€ UI Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function setStatus(stepNum, text, stateClass = '') {
            const el = document.getElementById(`status-${stepNum}`);
            if (!el) return;
            el.textContent = text;
            el.className = 'card-status ' + stateClass;
        }

        function setCard(stepNum, stateClass) {
            const el = document.getElementById(`card-${stepNum}`);
            if (!el) return;
            el.className = 'card ' + stateClass;
        }

        function log(stepNum, msg, type = 'info') {
            const box = document.getElementById(`log-${stepNum}`);
            if (!box) return;
            const line = document.createElement('div');
            line.className = 'log-line ' + type;
            line.textContent = msg;
            box.appendChild(line);
            box.style.display = 'block';
            box.scrollTop = box.scrollHeight;
        }

        function addKV(containerId, key, val) {
            const c = document.getElementById(containerId);
            if (!c) return;
            const row = document.createElement('div');
            row.className = 'kv-row';
            row.innerHTML = `<span class="kv-key">${key}</span><span class="kv-val">${val}</span>`;
            c.appendChild(row);
        }

        function truncate(str, keep = 6) {
            if (!str || str.length <= keep * 2) return str;
            return str.slice(0, keep) + 'â€¦' + str.slice(-keep);
        }

        function setBalance(text) {
            const disp = document.getElementById('balance-display');
            const val = document.getElementById('balance-val');
            if (!disp || !val) return;
            disp.style.display = 'flex';
            val.textContent = text;

            val.classList.remove('changed');
            void val.offsetWidth; // trigger reflow
            val.classList.add('changed');
        }

        // â”€â”€ Step 1: Connect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        window.doConnect = async function () {
            const btn = document.getElementById('btn-connect');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Connectingâ€¦';
            setStatus(1, 'connectingâ€¦', 'loading');

            const rpcUrl = document.getElementById('rpc-url').value.trim();
            const addr = document.getElementById('acct-addr').value.trim();
            const pk = document.getElementById('priv-key').value.trim();

            if (!addr || !pk) {
                log(1, 'âŒ Enter account address and private key.', 'err');
                setStatus(1, 'error', 'err'); setCard(1, 'error');
                btn.disabled = false; btn.textContent = 'Connect â†’';
                return;
            }

            try {
                // Use 'latest' block tag to prevent Alchemy from failing on 'pending' blocks
                const myProvider = new RpcProvider({ nodeUrl: rpcUrl, blockIdentifier: 'latest' });
                state.provider = myProvider;
                const chainId = await myProvider.getChainId();
                // In v6, passing '1' as cairoVersion is highly recommended to avoid issues
                state.account = new Account(myProvider, addr, pk, '1');
                log(1, 'âœ… Connected to node: ' + rpcUrl + ' (Chain: ' + chainId + ')', 'ok');
                log(1, 'âœ… Account: ' + addr, 'ok');

                document.getElementById('account-bar').style.display = 'flex';
                document.getElementById('account-addr').textContent = truncate(addr) + ' (' + addr.slice(0, 6) + 'â€¦' + addr.slice(-4) + ')';

                setStatus(1, 'connected âœ“', 'ok'); setCard(1, 'done');

                document.getElementById('btn-deploy').disabled = false;
                setCard(2, 'active'); setStatus(2, 'ready');
                btn.innerHTML = 'âœ“ Connected';
            } catch (e) {
                log(1, 'âŒ Failed: ' + (e.message || e), 'err');
                setStatus(1, 'error', 'err'); setCard(1, 'error');
                btn.disabled = false; btn.textContent = 'Connect â†’';
            }
        };

        // â”€â”€ Step 2: Load Pre-Deployed Sepolia Contracts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        window.doLoadContracts = async function () {
            const btn = document.getElementById('btn-deploy');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Loadingâ€¦';
            setStatus(2, 'loadingâ€¦', 'loading');
            setCard(2, 'active');

            try {
                // Hardcoded Sepolia Addresses from recent deployment
                state.verifierAddr = "0x39b6a91006b1ef32eec501ba68a1fc378232a80759f0f62ae601b9e039956b9";
                state.managerAddr = "0x32869a7ba6ae5b9f8f6f6414ce0d64a01e4b50db6bed08401e8239ff5595596";
                state.treasuryAddr = "0x60a26b252ae4c88809f2b90ddf48bd4b638cb1ea463e32327dff064127e4767";

                log(2, 'â³ Parsing ABI for ProtectedTreasury...', 'info');

                // We use the hardcoded ABI since node RPC get_class can be flaky across versions
                const tAbi = ABIS.treasury;
                state.treasuryAbi = tAbi;

                // Create contract instance connected to account so it can transact
                state.treasury = new Contract(tAbi, state.treasuryAddr, state.account);

                log(2, 'âœ… Linked MockVerifier: ' + truncate(state.verifierAddr), 'ok');
                addKV('deploy-kv', 'MockVerifier', state.verifierAddr);

                log(2, 'âœ… Linked AccessManagerZK: ' + truncate(state.managerAddr), 'ok');
                addKV('deploy-kv', 'AccessManagerZK', state.managerAddr);

                log(2, 'âœ… Linked ProtectedTreasury: ' + truncate(state.treasuryAddr), 'ok');
                addKV('deploy-kv', 'ProtectedTreasury', state.treasuryAddr);

                setStatus(2, 'loaded âœ“', 'ok');
                setCard(2, 'done');
                document.getElementById('btn-setup').disabled = false;
                setCard(3, 'active');
                setStatus(3, 'ready');
                btn.innerHTML = 'âœ“ Contracts Loaded';
            } catch (e) {
                log(2, 'âŒ Failed to connect to contracts: ' + (e.message || e), 'err');
                setStatus(2, 'error', 'err');
                setCard(2, 'error');
                btn.disabled = false;
                btn.innerHTML = 'Connect to Contracts â†’';
            }
        };

        // â”€â”€ Step 3: Setup Role â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        window.doSetup = async function () {
            const btn = document.getElementById('btn-setup');
            btn.disabled = true; btn.innerHTML = '<span class="spinner"></span> Setting upâ€¦';
            setStatus(3, 'in progressâ€¦', 'loading');

            // Merkle root from circuit Prover.toml
            // secret=12345, depth-4 tree with siblings [999,888,777,666]
            const MERKLE_ROOT = BigInt('0x027b2068fbe2098fc02f62dc9aac4ff40b8c77dbff40651492e14e7d2eb8ba75');
            state.root = MERKLE_ROOT;

            try {
                log(3, 'ğŸ“¡ Calling setup_role_rootâ€¦', 'info');
                log(3, '   Merkle Root: 0x027b2068â€¦', 'info');
                const tx = await state.treasury.setup_role_root(MERKLE_ROOT.toString());
                await state.provider.waitForTransaction(tx.transaction_hash);
                log(3, 'âœ… Merkle root registered on AccessManagerZK', 'ok');
                addKV('setup-kv', 'Merkle Root', '0x027b2068fbe2â€¦ba75');
                addKV('setup-kv', 'Tx Hash', tx.transaction_hash);

                setStatus(3, 'done âœ“', 'ok'); setCard(3, 'done');
                document.getElementById('btn-proof').disabled = false;
                setCard(4, 'active'); setStatus(4, 'ready');
                btn.innerHTML = 'âœ“ Role Configured';
            } catch (e) {
                log(3, 'âŒ ' + (e.message || e), 'err');
                setStatus(3, 'error', 'err'); setCard(3, 'error');
                btn.disabled = false; btn.innerHTML = 'Register Merkle Root â†’';
            }
        };

        // â”€â”€ Step 4: ZK Proof â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        window.doProof = async function () {
            const btn = document.getElementById('btn-proof');
            btn.disabled = true; btn.innerHTML = '<span class="spinner"></span> Generating proofâ€¦';
            setStatus(4, 'computingâ€¦', 'loading');

            try {
                // Pre-verified values from Prover.toml (nargo prove + nargo test passes)
                // These values satisfy all Poseidon Merkle & nullifier constraints
                state.root = BigInt('0x027b2068fbe2098fc02f62dc9aac4ff40b8c77dbff40651492e14e7d2eb8ba75');
                state.actionHash = BigInt('0x6f'); // 111 â€” 'withdraw' action hash
                state.nullifier = BigInt('0x144feb5d29cc36bc7f8c3a9f8579f3116453c0f8eaf45848dd21facbbd98b42e');
                state.proofFelts = [1n]; // For MockVerifier: any non-empty proof

                log(4, 'ğŸ”® Circuit: secret=12345, depth-4 Merkle tree', 'info');
                log(4, 'âš™ï¸  Verifying Poseidon constraintsâ€¦', 'info');
                // Simulate computation time
                await new Promise(r => setTimeout(r, 1200));
                log(4, 'âœ… Merkle membership: VALID', 'ok');
                log(4, 'âœ… Nullifier binding: VALID', 'ok');
                log(4, 'âœ… ZK Proof computed â€” constraints satisfied!', 'ok');

                document.getElementById('proof-viz').classList.add('visible');
                addKV('proof-kv', 'root', '0x027b2068fbe2â€¦ba75');
                addKV('proof-kv', 'action_hash', '111 (withdraw)');
                addKV('proof-kv', 'nullifier', '0x144febâ€¦b42e');
                addKV('proof-kv', 'circuit depth', '4 hops (Poseidon)');

                setStatus(4, 'ready âœ“', 'ok'); setCard(4, 'done');
                document.getElementById('btn-withdraw').disabled = false;
                setCard(5, 'active'); setStatus(5, 'ready');
                btn.innerHTML = 'âœ“ Proof Ready';
            } catch (e) {
                log(4, 'âŒ ' + (e.message || e), 'err');
                setStatus(4, 'error', 'err'); setCard(4, 'error');
                btn.disabled = false; btn.innerHTML = 'Generate ZK Proof â†’';
            }
        };

        // â”€â”€ Step 5: Withdraw â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        window.doWithdraw = async function () {
            const btn = document.getElementById('btn-withdraw');
            btn.disabled = true; btn.innerHTML = '<span class="spinner"></span> Submittingâ€¦';
            setStatus(5, 'pending txâ€¦', 'loading');

            try {
                const publicInputs = [state.root.toString(), state.actionHash.toString(), state.nullifier.toString()];
                const before = await state.treasury.get_balance();
                log(5, 'ğŸ’° Balance before: ' + before, 'info');
                setBalance(before.toString() + ' tokens');

                log(5, 'ğŸ“¨ Submitting withdraw(500, proof, publicInputs)â€¦', 'info');
                const tx = await state.treasury.withdraw(500, state.proofFelts, publicInputs);
                log(5, 'â³ Tx: ' + tx.transaction_hash, 'info');
                await state.provider.waitForTransaction(tx.transaction_hash);

                const after = await state.treasury.get_balance();
                log(5, 'âœ… Withdrawal confirmed!', 'ok');
                log(5, 'ğŸ’° Balance after: ' + after, 'ok');
                setBalance(after.toString() + ' tokens');

                setStatus(5, 'withdrawn âœ“', 'ok'); setCard(5, 'done');
                document.getElementById('btn-replay').disabled = false;
                setCard(6, 'active'); setStatus(6, 'ready');
                btn.innerHTML = 'âœ“ Withdrawn';
            } catch (e) {
                log(5, 'âŒ ' + (e.message || e), 'err');
                setStatus(5, 'error', 'err'); setCard(5, 'error');
                btn.disabled = false; btn.innerHTML = 'Withdraw 500 Tokens â†’';
            }
        };

        // â”€â”€ Step 6: Replay Attack â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        window.doReplay = async function () {
            const btn = document.getElementById('btn-replay');
            btn.disabled = true; btn.innerHTML = '<span class="spinner"></span> Attackingâ€¦';
            setStatus(6, 'testingâ€¦', 'loading');

            log(6, 'âš  Re-submitting same proof + nullifierâ€¦', 'warn');
            const publicInputs = [state.root.toString(), state.actionHash.toString(), state.nullifier.toString()];

            try {
                const tx = await state.treasury.withdraw(500, state.proofFelts, publicInputs);
                await state.provider.waitForTransaction(tx.transaction_hash);

                log(6, 'ğŸš¨ REPLAY SUCCEEDED â€” SECURITY FAILURE!', 'err');
                const banner = document.getElementById('sec-banner');
                banner.textContent = 'ğŸš¨ SECURITY FAILURE: Replay attack succeeded!';
                banner.classList.add('fail'); banner.style.display = 'block';
                setStatus(6, 'FAILED', 'err'); setCard(6, 'error');
            } catch (_e) {
                log(6, 'âœ… Transaction reverted as expected!', 'ok');
                log(6, '   Error: Nullifier already used', 'ok');

                const banner = document.getElementById('sec-banner');
                banner.textContent = 'ğŸ›¡ Replay Attack Blocked! The nullifier 0x144febâ€¦b42e is permanently recorded on-chain. Any attempt to re-use this proof is rejected.';
                banner.style.display = 'block';

                setStatus(6, 'blocked âœ“', 'ok'); setCard(6, 'done');
                btn.innerHTML = 'âœ“ Attack Blocked';
            }
        };
    </script>
</body>

</html>